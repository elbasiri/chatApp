<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Node.js Chat App</title>
</head>
<body>
  <ul id="messages"></ul>
  <form id="form" action="">
    <input id="m" autocomplete="off" required/><button>Send</button>
  </form>

  <script src="/app.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="https://cdn.jsdelivr.net/npm/uuid@8.3.2/dist/umd/uuidv4.min.js"></script>

<script>
  $(function () {
    const socket = io();
    const senderId = generateUniqueId();

    $('form').submit(function () {
      const username = $('#username').val();
      const message = $('#m').val();
      socket.emit('chat message', { senderId: senderId,text: message });
      $('#m').val('');
      return false;
    });

    socket.on('chat message', function (data) {
      const timestamp = new Date().toLocaleTimeString();
      $('#messages').append($('<li>').text(`${timestamp} - ${data.senderId}: ${data.text}`));

      // Remove excess messages to keep the display tidy
      const messages = $('#messages li');
      const MAX_MESSAGES = 50; // Adjust as needed
      if (messages.length > MAX_MESSAGES) {
        messages.slice(0, messages.length - MAX_MESSAGES).remove();
      }
    });

    // Display chat history when connected
    socket.on('chat history', function (messages) {
      messages.forEach(function (msg) {
        const timestamp = new Date().toLocaleTimeString();
        $('#messages').append($('<li>').text(`${timestamp} - ${msg.senderId} : ${msg.text}`));
      });
    });

    function generateUniqueId() {
      const funnyNames = ['fuck', 'nobody', 'shit', 'king', 'peasent'];
      const randomIndex = Math.floor(Math.random() * funnyNames.length);
      return funnyNames[randomIndex];
    }
  });
</script>

</body>
</html>
 